<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>COVID-19 Retrospectively Around The World</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  </head>
  <body>
  <div class="container">
    <div class="row">
      <div class="col-md-12 jumbotron text-center">
        <h1> A Retrospective Look on Covid-19 </h1>
        <p>Use the interactive charts below to explore the dataset</p>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-2">
      <div class="well">
        <label for="dropdown">Countries:</label>
        <select id="selDataset" onchange="optionChanged(this.value)"></select>
      </div> 
      <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="chart.js"></script>
  </body>
</html>

<script>
  function genCasesChart(covidData) {
    const canvas = document.getElementById("covidChart");
    const ctx = canvas.getContext("2d");

    // Extract labels (countries) and data (percentages) from the covidData array
    const labels = covidData.map((item) => item.country);
    const casesData = covidData.map((item) => item.percentage);
    const deathsData = covidData.map((item) => item.deathsPercentage);
    const vaccineData = covidData.map((item) => item.percentVacinated);

    // Create the chart
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [
          {
            label: "Percentage Cases Per Population",
            data: casesData,
            backgroundColor: "rgba(75, 192, 192, 0.7)",
          },
          {
            label: "Percent Deaths Per Population",
            data: deathsData,
            backgroundColor: "rgba(255, 99, 132, 0.7)",
          },
          {
            label: "Percent Vaccinated Per Population",
            data: vaccineData,
            backgroundColor: "rgba(255, 255, 0, 0.7)",
          },
        ],
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: "Percentage of Cases",
            },
          },
        },
      },
    });
  }

  function genCasesChart2(covidData) {
    const canvas = document.getElementById("covidChart2");
    const ctx = canvas.getContext("2d");

    // Extract labels (countries) and data (percentages) from the covidData array
    const labels = covidData.map((item) => item.country);
    const deathsData = covidData.map((item) => item.deathsPercentage);
    const percentDiabetes = covidData.map((item) => item.percentDiabetes);

    // Create the chart
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [
          {
            label: "Percent Deaths Per Population",
            data: deathsData,
            backgroundColor: "rgba(255, 99, 132, 0.7)",
          },
          {
            label: "Percent Diabetes Per Population",
            data: percentDiabetes,
            backgroundColor: "rgba(255, 255, 0, 0.7)",
          },
        ],
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: "Percentage of Cases",
            },
          },
        },
      },
    });
  }

  function getData() {
    $.ajax({
      url: "http://127.0.0.1:5000/api/get_country_percentage", // Replace with your API endpoint
      method: "GET",
      dataType: "json",
      success: function (data) {
        console.log(data);
        var chart1 = [];
        var chart2 = [];
        var chart3 = [];
        for (var row of data) {
          var country = row[1].trim();
          var percentCases = parseFloat(row[0]).toFixed(2);
          var percentDeaths = parseFloat(row[2]).toFixed(2);
          var percentVacinated = parseFloat(row[3]).toFixed(2);
          var percentDiabetes = parseFloat(row[7]).toFixed(2);
          chart1.push({
            country: country,
            percentage: percentCases,
            deathsPercentage: percentDeaths,
            percentVacinated: percentVacinated,
          });
          chart2.push({
            country: country,
            deathsPercentage: percentDeaths,
            percentDiabetes: percentDiabetes,
          });
         
        }
        console.log(chart1);
        genCasesChart(chart1);
        genCasesChart2(chart2);
      },
      error: function () {
        // Handle any errors here
        var dataContainer = $("#data-container");
        dataContainer.html("<p>Error loading data</p>");
      } ,
    });
  }

  getData();
</script>
